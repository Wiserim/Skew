/*!
* Skew v0.6
* Copyright 2018 Marcin Walczak
*This file is part of Skew which is released under MIT license.
*See LICENSE for full license details.
*/
function Skew(e,t){"string"==typeof e?this.targets=document.querySelectorAll(e):e.nodeType?this.targets=[e]:this.targets=e,this.defaults={x:0,y:0,unskewContent:!1,breakpoints:[],debounce:!0,debounceTime:50},this.options=this.defaults,this.currentUnskewContent=this.options.unskewContent,this.timeout,this.update(t);var n=this;return this.eventMethod=function(){var e=n.options.debounce,t=n.options.debounceTime;if(void 0!==n.options.breakpoints){var o=window.innerWidth;n.options.breakpoints.forEach(function(n){n.break>=o&&(void 0!==n.debounce&&(e=n.debounce),void 0!==n.debounceTime&&(t=n.debounceTime))})}if(e){clearTimeout(n.timeout),n.timeout=setTimeout(function(){n.timeout=null,n.skew()},t)}else n.skew()},window.addEventListener("load",this.eventMethod),window.addEventListener("resize",this.eventMethod),this}window.jQuery&&($.fn.skew=function(e){$.makeArray(arguments);return this.each(function(){var t=$.data(this,"skewjs");if(t)if("string"==typeof e)t[e]?(t[e].apply(t,n),"destroy"==e&&$.removeData(this,"skewjs")):$.error("Method "+e+" does not exist on Skew");else{var n=$.extend({x:0,y:0,breakpoints:[]},e);t.update(n)}else if("string"!=typeof e){var o=new Skew(this,n=$.extend({x:0,y:0,breakpoints:[]},e));return $.data(this,"skewjs",o),o}})}),Skew.prototype={skew:function(){var e=this,t=null,n=0,o=0,s=e.options.x,i=e.options.y,r=0,u=0;if(content=[],unskewContent=e.options.unskewContent,contentSkewStyle="",void 0!==e.options.breakpoints){var d=window.innerWidth;if(e.options.breakpoints.forEach(function(e){e.break<d||(void 0!==e.x&&(s=e.x),void 0!==e.y&&(i=e.y),void 0!==e.unskewContent&&(unskewContent=e.unskewContent))}),e.currentUnskewContent!==unskewContent){for(var a=0;a<e.targets.length;a++){t=e.targets[a],!0===e.currentUnskewContent?content=t.childNodes:"string"==typeof e.currentUnskewContent&&(content=t.querySelectorAll(e.currentUnskewContent));for(var k=0;k<content.length;k++)e.setSkewStyle(content[k],"")}content=[],e.currentUnskewContent=unskewContent}}for(a=0;a<e.targets.length;a++){n=(t=e.targets[a]).offsetWidth,o=t.offsetHeight,r=Math.atan(s/o),u=Math.atan(i/n),skewStyle="skew("+r+"rad, "+u+"rad)",e.setSkewStyle(t,skewStyle),!0===unskewContent?content=t.childNodes:"string"==typeof unskewContent&&(content=t.querySelectorAll(unskewContent)),contentSkewStyle="skew("+-r+"rad, "+-u+"rad)";for(k=0;k<content.length;k++)e.setSkewStyle(content[k],contentSkewStyle)}return this},update:function(e){return this.options=this.parseSettings(e,this.options),this.skew(),this},destroy:function(){window.removeEventListener("resize",this.resizeEvent);for(var e=0;e<this.targets.length;e++){var t=this.targets[e],n=t.getAttribute("style"),o=n.indexOf("skew"),s=o+n.substring(o).indexOf(")")+1;if(o>-1){var i=n.substring(0,o),r=n.substring(s);t.setAttribute("style",i+r)}}},parseSettings:function(e,t){var n=void 0!==t?t:this.defaults;return void 0!==e&&(void 0!==e.x&&(n.x=e.x),void 0!==e.y&&(n.y=e.y),void 0!==e.unskewContent&&(n.unskewContent=e.unskewContent),Array.isArray(e.breakpoints)&&(n.breakpoints=[],e.breakpoints.forEach(function(e){var t={break:void 0!==e.break?e.break:0};void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.unskewContent&&(t.unskewContent=e.unskewContent),void 0!==e.debounce&&(t.debounce=e.debounce),void 0!==e.debounceTime&&(t.debounce=e.debounceTime),n.breakpoints.push(t)}),n.breakpoints.sort(function(e,t){return e.break<t.break?1:e.break>t.break?-1:0})),void 0!==e.debounce&&(n.debounce=e.debounce),void 0!==e.debounceTime&&(n.debounceTime=e.debounceTime)),n},setSkewStyle:function(e,t){var n=e.getAttribute("style");if(null===n)return n="transform: "+t+";",void e.setAttribute("style",n);var o=n.indexOf("transform:");if(o<0)return n+="transform: "+t+";",void e.setAttribute("style",n);var s=o+n.substring(o).indexOf(";");s<o&&(s=n.length,t+=";");var i=n.indexOf("skew"),r=n.substring(0,s),u=n.substring(s);if(i<0)return n=r+" "+t+u,void e.setAttribute("style",n);s=(o=n.indexOf("skew"))+n.substring(o).indexOf(")")+1,n=(r=n.substring(0,o))+t+(u=n.substring(s)),e.setAttribute("style",n)}};
